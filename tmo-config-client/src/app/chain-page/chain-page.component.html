<nz-card class="parser-chain" *ngIf="chain" [nzTitle]="breadcrumbsCardTitle">
  <div class="add-parser">
    <a routerLink="new">Add new parser</a>
  </div>
  <div nz-row nzGutter="16">
    <div nz-col nzSpan="10">
      <app-chain-view
        [parsers]="(breadcrumbs.length > 0 && breadcrumbs[breadcrumbs.length - 1].parsers) || (chain && chain.parsers)"
        [dirtyParsers]="(dirtyChains[(breadcrumbs.length > 0 && breadcrumbs[breadcrumbs.length - 1].id) || (chain && chain.id)] || { parsers: [] }).parsers"
        (removeParserEmitter)="removeParser($event)"
        (chainLevelChange)="onChainLevelChange($event)"
        (parserChange)="onParserChange($event)"
      ></app-chain-view>
    </div>
    <div nz-col nzSpan="14">
      <app-live-view [chainConfig$]="chainConfig$"></app-live-view>
    </div>
  </div>
</nz-card>

<ng-template #breadcrumbsCardTitle>
  <nz-breadcrumb>
    <nz-breadcrumb-item *ngFor="let breadcrumb of breadcrumbs; index as i">
      <span *ngIf="dirtyChains[breadcrumb.id] && dirtyChains[breadcrumb.id].parsers.length > 0">
        <i nz-icon nzType="exclamation-circle" nzTheme="twotone" [nzTwotoneColor]="'#f00'"></i>
        ({{ dirtyChains[breadcrumb.id].parsers.length }})
      </span>
      <a *ngIf="i < breadcrumbs.length - 1" href="#" (click)="onBreadcrumbClick($event, breadcrumb)">{{ breadcrumb.name }}</a>
      <span *ngIf="i === breadcrumbs.length - 1">{{ breadcrumb.name }}</span>
    </nz-breadcrumb-item>
  </nz-breadcrumb>
  <div class="chain-name">
    <span>
      {{chain.name}}
      <button
        data-qe-id="chain-name-edit-btn"
        nz-button
        nz-popconfirm
        [nzPopconfirmTitle]="inputChainNameContent"
        nzPopconfirmPlacement="bottom"
        (nzOnConfirm)="updateChainName()"
        [nzVisible]="isNameChangePopconfirmVisible"
        nzType="default" class="chain-edit-btn"
        nzOkText="Confirm"
        (click)="onEditChainNameClick($event)"
      ><i nz-icon nzType="edit" nzTheme="fill"></i></button>
    </span>
    <ng-template #inputChainNameContent>
      <div>
        <span>Edit Chain Name: </span>
        <input nz-input #chainNameInput type="text" placeholder="Enter Chain Name" value ="{{ chain.name }}" (keyup.enter)="updateChainName()" data-qe-id="chain-name-field">
      </div>
    </ng-template>
  </div>
  <div class="chain-actions">
    <button nz-button nzType="default" type="button" (click)="onResetChanges($event)" [disabled]="!dirty">
      Reset
    </button>
    <button nz-button nzType="primary" type="button" (click)="onSaveChanges($event)" [disabled]="!dirty">
      Save
    </button>
  </div>
</ng-template>
