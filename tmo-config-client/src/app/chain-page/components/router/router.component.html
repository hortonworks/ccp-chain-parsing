<div class="parser">
  <nz-card class="chain-item" [nzBordered]="true" [nzTitle]="parser.name" [nzExtra]="extraTemplate">
    <nz-tabset
      nzTabPosition="top"
      nzType="line"
    >
      <nz-tab nzTitle="Basics">
        <app-custom-form
          *ngIf="areFormsReadyToRender && metaDataForm != null"
          [config]="metaDataForm"
        ></app-custom-form>
        <nz-form-item>
          <nz-form-label [nzSm]="8" [nzXs]="24">
            Type
          </nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24">
            Router
          </nz-form-control>
        </nz-form-item>
      </nz-tab>
      <nz-tab nzTitle="Config">
        <div class="router-config" *ngIf="parser.config">
          <div class="matching-field">
            <nz-form-item>
              <nz-form-label
                [nzSm]="4"
                [nzFor]="parser.id"
              >
                Matching field
              </nz-form-label>
              <nz-form-control [nzSm]="16">
                <input
                  id="{{ parser.id }}"
                  nz-input
                  (blur)="onMatchingFieldBlur($event, parser)"
                  placeholder="Add matching field"
                  value="{{ parser.config.matchingField }}"
                />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div class="routes">
            <a
              href="#"
              class="add-route"
              (click)="onAddRouteClick($event, parser)"
            >
              <i nz-icon nzType="file-add" nzTheme="outline"></i>
              Add route
            </a>
            <app-route
              *ngFor="let routeId of parser.config.routes; trackBy: trackByFn"
                [parser]="parser"
                [routeId]="routeId"
                (chainClick)="onSubchainClick($event)"
              ></app-route>
          </div>
        </div>
      </nz-tab>
      <nz-tab nzTitle="Outputs">
        Outputs tab
      </nz-tab>
    </nz-tabset>
  </nz-card>
  <ng-template #extraTemplate>
    <div *ngIf="dirty" class="parser-dirty">
      <i nz-icon nzType="exclamation-circle" nzTheme="twotone" [nzTwotoneColor]="'#1890ff'"></i>
    </div>
    <button
      nz-popconfirm
      nzPopconfirmTitle="Are you sure delete this task?"
      (nzOnConfirm)="onRemoveParser(parser.id)"
      nzPopconfirmPlacement="right"
      nz-button
      nzType="link"
      data-qe-id="remove-parser"
    >
      Remove Parser
    </button>
  </ng-template>
</div>
